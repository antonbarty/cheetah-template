#
# Default .ini file for crystal hit finding
#
# Note that CXI have been swapping around CSPAD detectors and therefore the
# name of the detectors in each position have been changing frequently.
# Sometimes the front detector is CXI:DS1 and sometimes it is CXI:DS2
# Make sure to update both the detector name and encoder PV name.
# Darkcal .ini files may need to be changed to match. 
#

defaultphotonenergyev=9600

[front]
detectorType=cspad
detectorName=CxiDs1
geometry=../../calib/geometry/cspad-front-12feb2013.h5
pixelSize=0.000110
detectorZpvname=CXI:DS1:MMS:06.RBV
cameraLengthOffset=592.0
cameraLengthScale=0
defaultcameralengthmm=100
darkcal=../../calib/darkcal/20140130-r0018-CxiDs1-darkcal.h5
badpixelmap=../../calib/mask/CxiDs1-badpixels-201401.h5

# For cspad v1.6 modules only (January 2014 onwards)
#subtractUnbondedPixels=1

useAutoHotPixel=0
hotpixADC=10000
hotpixFreq=0.9

saveDetectorRaw=0
saveDetectorCorrected=1
saveDetectorAndPhotonCorrected=0

useRadialBackgroundSubtraction=1
useLocalBackgroundSubtraction=0
localbackgroundradius=2
useSubtractPersistentBackground=0
bgmemory=50
bgrecalc=50
bgmedian=0.5
bgIncludeHits=1
useBackgroundBufferMutex=0


[]
hitfinder=1
hitfinderDetectorID=0
hitfinderAlgorithm=8
hitfinderADC=150
hitfinderMinSNR=8
hitfinderNpeaks=20
hitfinderNpeaksMax=5000
hitfinderMinPixCount=2
hitfinderMaxPixCount=40
#hitfinderLocalBgRadius=3
#hitfinderMinPeakSeparation=0
hitfinderMinRes=0
hitfinderMaxRes=1300
hitfinderFastScan=0
peakmask=../../calib/mask/CxiDs1-badpixels-201401.h5


# Event sorting (eg: pump laser on or off)
sortPumpLaserOn=0
pumpLaserScheme=evr41


# Powder pattern creation
powderSumHits=1
powderSumBlanks=1
powderThresh=100
powderSumWithBackgroundSubtraction=1
saveInterval=1000
saveRadialStacks=0
radialStackSize=20000
savehits=1
saveRaw=1
saveAssembled=0
debugLevel=0

#Saving options
saveCXI=1
savePixelmask=1
# Accepted formats = {INT16,INT32,float}
dataSaveFormat=INT16
hdf5dump=0

# Special processing types
generateDarkcal=0
generateGaincal=0

# Energy spectrum stuff (inline spectrometer)
espectrum=0
espectrum1D=0
espectrumtiltang=0
espectrumlength=1000
#espectrumwidth=900

nThreads=16
